generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  ADMIN
  STAFF
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}

model Profile {
  id          String        @id @db.Uuid
  email       String        @unique
  role        Role          @default(STAFF)
  staffMember StaffMember?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Client {
  id           String        @id @default(cuid())
  fullName     String
  phone        String?
  email        String?
  notes        String?
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Service {
  id           String        @id @default(cuid())
  name         String
  durationMin  Int
  priceCents   Int
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model StaffMember {
  id           String        @id @default(cuid())
  profileId    String        @unique @db.Uuid
  displayName  String
  profile      Profile       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Appointment {
  id            String            @id @default(cuid())
  clientId      String
  serviceId     String
  staffMemberId String
  startAt       DateTime
  endAt         DateTime
  priceCents    Int
  status        AppointmentStatus @default(SCHEDULED)
  notes         String?
  client        Client            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  service       Service           @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  staffMember   StaffMember       @relation(fields: [staffMemberId], references: [id], onDelete: Restrict)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@index([startAt])
  @@index([clientId])
  @@index([staffMemberId])
}
